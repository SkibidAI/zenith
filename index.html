<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith | 2026 Intelligence</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --bg: #050505;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-thick: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.12);
            --accent: #ffffff;
            --text: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.45);
            --curve: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; outline: none; }
        ::-webkit-scrollbar { display: none; }
        
        body, html { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg);
            color: var(--text); scrollbar-width: none;
        }

        .mesh-bg {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(at 0% 0%, #1a1a1a 0%, transparent 50%),
                        radial-gradient(at 100% 100%, #0a0c20 0%, transparent 50%),
                        radial-gradient(at 50% 50%, #050505 0%, #000 100%);
        }

        /* LANDING PAGE */
        #landing-page {
            position: fixed; inset: 0; z-index: 1000; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 1.2s var(--curve);
        }
        #landing-page.hide { opacity: 0; transform: scale(1.1); pointer-events: none; }
        .ios-logo { font-size: 7rem; font-weight: 800; letter-spacing: -5px; filter: blur(10px); animation: logo-reveal 2s forwards; }
        @keyframes logo-reveal { to { filter: blur(0); letter-spacing: -2px; } }

        /* MAIN UI STAGE */
        #main-stage { display: grid; grid-template-columns: 280px 1fr; height: 100vh; opacity: 0; transition: 1.5s var(--curve); }
        #main-stage.visible { opacity: 1; }

        .sidebar {
            background: rgba(255,255,255,0.02); backdrop-filter: blur(60px);
            border-right: 1px solid var(--border); padding: 50px 25px;
            display: flex; flex-direction: column; gap: 20px; z-index: 10;
        }

        /* THE DIAL */
        .wheel-container {
            position: fixed; right: 25px; top: 50%; transform: translateY(-50%);
            width: 40px; height: 300px; z-index: 1000; display: flex; flex-direction: column;
            align-items: center; justify-content: space-between;
        }
        .wheel-track { position: absolute; width: 1px; height: 100%; background: var(--border); left: 50%; transform: translateX(-50%); }
        .wheel-knob {
            width: 44px; height: 44px; background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: #000;
            cursor: grab; z-index: 2; transition: transform 0.2s; box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        .ios-btn {
            background: var(--glass); border: 1px solid var(--border);
            padding: 14px 24px; border-radius: 20px; cursor: pointer;
            color: var(--text); font-weight: 600; display: flex; align-items: center; gap: 12px;
            transition: 0.4s var(--curve); text-decoration: none;
        }
        .ios-btn:hover { background: var(--glass-thick); border-color: var(--accent); }

        /* CONTENT AREAS */
        .content-wrapper { position: relative; display: flex; flex-direction: column; overflow: hidden; height: 100vh; }
        .view-section { display: none; flex-direction: column; height: 100%; padding: 60px 15% 200px; overflow-y: scroll; scroll-behavior: smooth; }
        .view-section.active { display: flex; }

        /* MESSAGE FIX (STRICT STACKING) */
        #chat-feed { display: flex; flex-direction: column; gap: 35px; width: 100%; }
        .msg { display: flex; flex-direction: column; width: 100%; clear: both; animation: ios-slide 0.5s var(--curve); position: relative; }
        .role { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; opacity: 0.5; }
        .content { font-size: 1.1rem; line-height: 1.6; word-wrap: break-word; white-space: pre-wrap; width: 100%; }

        @keyframes ios-slide { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* PROMPT GRID */
        .prompt-card {
            background: var(--glass); border: 1px solid var(--border); padding: 20px;
            border-radius: 24px; cursor: pointer; transition: 0.4s; text-align: left;
        }
        .prompt-card:hover { border-color: var(--accent); background: var(--glass-thick); }
        .prompt-card .cat { font-size: 0.6rem; font-weight: 800; color: var(--accent); text-transform: uppercase; margin-bottom: 5px; opacity: 0.6; }

        /* IMAGE FRAME */
        #generated-image-frame {
            width: 100%; min-height: 450px; background: var(--glass); border: 1px solid var(--border);
            border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin-top: 30px; overflow: hidden; position: relative;
        }
        #generated-image-frame img { width: 100%; height: auto; display: block; animation: fade-in 1s ease; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        /* INPUT AREA */
        .island-container {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 60%; max-width: 800px; z-index: 100;
        }
        .island-bar {
            background: rgba(15, 15, 15, 0.9); backdrop-filter: blur(40px);
            border: 1px solid var(--border); border-radius: 40px; padding: 10px 10px 10px 25px;
            display: flex; align-items: center; gap: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        textarea { flex: 1; background: transparent; border: none; color: white; resize: none; font-size: 1.1rem; font-family: inherit; max-height: 150px; }

        /* SETTINGS */
        #settings-tray {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(50px);
            z-index: 2000; transform: translateY(100%); transition: 0.8s var(--curve);
            display: flex; align-items: center; justify-content: center;
        }
        #settings-tray.open { transform: translateY(0); }
        .settings-card { background: var(--glass); border: 1px solid var(--border); padding: 40px; border-radius: 40px; width: 90%; max-width: 500px; }
        input[type="password"] { width: 100%; padding: 18px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 15px; color: #fff; margin: 10px 0 20px; }
    </style>
</head>
<body>

    <div class="mesh-bg"></div>

    <div class="wheel-container">
        <div class="wheel-track"></div>
        <div class="wheel-knob" id="dial-knob"><i class="fas fa-sort"></i></div>
    </div>

    <div id="landing-page">
        <div class="ios-logo">Zenith</div>
        <button class="ios-btn" onclick="boot()">Access Neural Link</button>
    </div>

    <div id="main-stage">
        <div class="sidebar">
            <h1 style="font-size: 1.5rem; letter-spacing: -1px; margin-bottom: 20px;">Zenith</h1>
            <button class="ios-btn" onclick="switchView('chat')"><i class="fas fa-brain"></i> Neural Link</button>
            <button class="ios-btn" onclick="switchView('image')"><i class="fas fa-eye"></i> Visual Engine</button>
            <button class="ios-btn" onclick="switchView('forum')"><i class="fas fa-globe"></i> Community</button>
            <button class="ios-btn" style="margin-top:auto" onclick="toggleSettings(true)"><i class="fas fa-key"></i> API Keys</button>
        </div>

        <div class="content-wrapper">
            <div id="view-chat" class="view-section active">
                <div id="welcome" style="margin-top:8vh; text-align:center;">
                    <h2 style="font-size: 3.5rem; letter-spacing:-2px; margin-bottom: 40px;">What are we building?</h2>
                    <div id="prompt-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; width:100%; max-width:650px; margin: 0 auto;"></div>
                </div>
                <div id="chat-feed"></div>
            </div>

            <div id="view-image" class="view-section">
                <h2 style="font-size: 3rem; letter-spacing:-2px;">Visual Engine</h2>
                <div id="generated-image-frame">
                    <p id="image-placeholder" style="opacity:0.4;">Describe a scene to begin synthesis...</p>
                </div>
                <div id="image-actions" style="margin-top: 25px; display:none;">
                     <a id="download-link" class="ios-btn" download="zenith_render.png"><i class="fas fa-cloud-download-alt"></i> Save Render</a>
                </div>
            </div>

            <div id="view-forum" class="view-section">
                <h2 style="font-size: 3rem; letter-spacing:-2px; margin-bottom:30px;">Community Feed</h2>
                <div id="forum-list"></div>
            </div>

            <div class="island-container">
                <div class="island-bar">
                    <textarea id="user-input" rows="1" placeholder="Type a command..." oninput="autoResize(this)"></textarea>
                    <button class="ios-btn" style="padding:0; border-radius:50%; width:45px; height:45px; background:#fff; color:#000; justify-content:center; flex-shrink:0;" onclick="handleAction()">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-tray">
        <div class="settings-card">
            <h3 style="margin-top:0;">Neural Bridge Settings</h3>
            
            <label style="font-size:0.7rem; font-weight:800; opacity:0.5;">GROQ API KEY (TEXT)</label>
            <input type="password" id="api-groq" placeholder="gsk_...">
            
            <label style="font-size:0.7rem; font-weight:800; opacity:0.5;">HUGGING FACE TOKEN (IMAGES)</label>
            <p style="font-size: 0.6rem; color: #aaa; margin-top:-15px;">Ensure this token has "WRITE" permissions.</p>
            <input type="password" id="api-hf" placeholder="hf_...">
            
            <button class="ios-btn" style="width:100%; justify-content:center; background:#fff; color:#000; margin-top:10px;" onclick="saveKeys()">Initialize Keys</button>
            <button class="ios-btn" style="width:100%; margin-top:10px; background:transparent; border:none;" onclick="toggleSettings(false)">Return</button>
        </div>
    </div>

    <script>
        let currentView = 'chat';
        let keys = { 
            groq: localStorage.getItem('z_groq') || '', 
            hf: localStorage.getItem('z_hf') || '' 
        };
        let posts = JSON.parse(localStorage.getItem('z_posts') || '[{"t":"System Online","b":"Neural Bridge v4.2 Active."}]');

        const promptPool = [
            { c: "Logic", t: "Explain Relativity like I'm 5." },
            { c: "Code", t: "Write a Python script to scrape a website." },
            { c: "Design", t: "A futuristic apartment with neon lighting." },
            { c: "Vision", t: "Cyberpunk version of ancient Rome, 8k." }
        ];

        function boot() {
            document.getElementById('landing-page').classList.add('hide');
            document.getElementById('main-stage').classList.add('visible');
            generatePrompts();
            renderForums();
            initDial();
            if(keys.groq) document.getElementById('api-groq').value = keys.groq;
            if(keys.hf) document.getElementById('api-hf').value = keys.hf;
        }

        function generatePrompts() {
            const grid = document.getElementById('prompt-grid');
            grid.innerHTML = promptPool.map(p => `
                <div class="prompt-card" onclick="fillPrompt('${p.t}')">
                    <div class="cat">${p.c}</div>
                    <div class="text">${p.t}</div>
                </div>
            `).join('');
        }

        function fillPrompt(t) {
            const input = document.getElementById('user-input');
            input.value = t;
            autoResize(input);
            handleAction();
        }

        function switchView(v) {
            currentView = v;
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            document.getElementById('user-input').placeholder = v === 'image' ? "Describe a visual scene..." : "Type a command...";
        }

        function handleAction() {
            const input = document.getElementById('user-input');
            const val = input.value.trim();
            if(!val) return;
            
            if(currentView === 'chat') sendChat(val);
            else if(currentView === 'image') generateImage(val);
            else postForum(val);
            
            input.value = ''; autoResize(input);
        }

        async function sendChat(text) {
            if(!keys.groq) { toggleSettings(true); return; }
            document.getElementById('welcome').style.display = 'none';
            appendMsg('User', text);
            const id = appendMsg('Zenith', '<i class="fas fa-circle-notch fa-spin"></i> Processing...');
            
            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${keys.groq}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: [{role:"user", content:text}] })
                });
                const data = await res.json();
                document.getElementById(id).innerHTML = marked.parse(data.choices[0].message.content);
            } catch(e) { 
                document.getElementById(id).innerHTML = `<span style="color:#ff6b6b">Link Interrupted. Check Groq API key.</span>`; 
            }
        }

        // --- NEW MULTI-MODEL IMAGE GEN ENGINE ---
        async function generateImage(prompt) {
            if(!keys.hf) { toggleSettings(true); return; }
            const frame = document.getElementById('generated-image-frame');
            const actions = document.getElementById('image-actions');
            
            frame.innerHTML = `<div style="text-align:center"><i class="fas fa-atom fa-spin"></i><br><br>Synthesizing Visual Data...</div>`;
            actions.style.display = 'none';

            // FALLBACK MODEL LIST
            const models = [
                "black-forest-labs/FLUX.1-dev", // Best quality
                "stabilityai/stable-diffusion-xl-base-1.0", // Balanced
                "runwayml/stable-diffusion-v1-5" // Easiest to access (fallback)
            ];

            async function attemptFetch(index) {
                if (index >= models.length) throw new Error("All model endpoints failed.");

                try {
                    const response = await fetch(`https://api-inference.huggingface.co/models/${models[index]}`, {
                        headers: { 
                            Authorization: `Bearer ${keys.hf.trim()}`, 
                            "Content-Type": "application/json" 
                        },
                        method: "POST",
                        body: JSON.stringify({ inputs: prompt }),
                    });

                    // Handle "Model Loading" state (503)
                    if (response.status === 503) {
                        const err = await response.json();
                        frame.innerHTML = `<div style="text-align:center"><i class="fas fa-clock"></i><br><br>Waking up Neural Engine... ${Math.round(err.estimated_time || 10)}s</div>`;
                        await new Promise(r => setTimeout(r, 6000));
                        return attemptFetch(index); 
                    }

                    if (!response.ok) throw new Error(`Model ${index} blocked`);

                    const blob = await response.blob();
                    const imgUrl = URL.createObjectURL(blob);
                    frame.innerHTML = `<img src="${imgUrl}" alt="Zenith Synthesis">`;
                    actions.style.display = 'flex';
                    document.getElementById('download-link').href = imgUrl;

                } catch (err) {
                    console.log(`Model ${models[index]} failed, trying next...`);
                    frame.innerHTML = `<div style="text-align:center"><i class="fas fa-exchange-alt"></i><br><br>Switching to Fallback Engine...</div>`;
                    return attemptFetch(index + 1);
                }
            }

            try {
                await attemptFetch(0);
            } catch(e) {
                frame.innerHTML = `
                    <div style="padding:40px; text-align:center; color:#ff6b6b;">
                        <i class="fas fa-shield-alt" style="font-size:2rem; margin-bottom:15px;"></i><br>
                        <strong>Synthesis Blocked (CORS or Auth)</strong><br><br>
                        <small style="color:#aaa">1. Ensure you have a <strong>WRITE</strong> token.<br>
                        2. Run this file using <strong>Live Server</strong> (VS Code).<br>
                        3. Check browser console (F12) for detailed logs.</small>
                    </div>`;
            }
        }

        function postForum(t) {
            posts.unshift({t, b: "Transmission from Zenith Terminal"});
            localStorage.setItem('z_posts', JSON.stringify(posts));
            renderForums();
        }

        function renderForums() {
            document.getElementById('forum-list').innerHTML = posts.map(p => `
                <div style="background:var(--glass); border:1px solid var(--border); padding:25px; border-radius:24px; margin-bottom:15px;">
                    <h3 style="margin:0 0 10px 0;">${p.t}</h3>
                    <p style="opacity:0.6; margin:0;">${p.b}</p>
                </div>
            `).join('');
        }

        function appendMsg(role, text) {
            const id = 'm' + Date.now();
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `<div class="role">${role}</div><div class="content" id="${id}">${text}</div>`;
            document.getElementById('chat-feed').appendChild(div);
            
            const feed = document.getElementById('view-chat');
            feed.scrollTop = feed.scrollHeight;
            return id;
        }

        function initDial() {
            const knob = document.getElementById('dial-knob');
            const track = document.querySelector('.wheel-container');
            let isDragging = false;
            
            knob.addEventListener('mousedown', () => isDragging = true);
            window.addEventListener('mouseup', () => isDragging = false);
            window.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const rect = track.getBoundingClientRect();
                let y = e.clientY - rect.top;
                y = Math.max(0, Math.min(y, rect.height - 44));
                knob.style.transform = `translateY(${y}px)`;
                
                const activeView = document.querySelector('.view-section.active');
                const scrollPct = y / (rect.height - 44);
                activeView.scrollTop = scrollPct * (activeView.scrollHeight - activeView.clientHeight);
            });
        }

        function toggleSettings(s) { document.getElementById('settings-tray').classList.toggle('open', s); }
        
        function saveKeys() {
            localStorage.setItem('z_groq', document.getElementById('api-groq').value.trim());
            localStorage.setItem('z_hf', document.getElementById('api-hf').value.trim());
            location.reload();
        }

        function autoResize(el) { 
            el.style.height = 'auto'; 
            el.style.height = el.scrollHeight + 'px'; 
        }
    </script>
</body>
</html>
